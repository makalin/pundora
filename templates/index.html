<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≠ Pundora - Dad Joke Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dad-blue': '#1e40af',
                        'dad-yellow': '#fbbf24',
                        'dad-orange': '#f97316'
                    }
                }
            }
        }
    </script>
    <style>
        .dad-gradient {
            background: linear-gradient(135deg, #1e40af 0%, #fbbf24 50%, #f97316 100%);
        }
        .joke-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="min-h-screen dad-gradient">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-6xl font-bold text-white mb-4 drop-shadow-lg">
                üé≠ Pundora
            </h1>
            <p class="text-xl text-white/90 mb-2">
                AI-powered Dad Joke Generator
            </p>
            <p class="text-lg text-white/80">
                Open the box. Unleash the puns. Welcome to the cringe! üòÇ
            </p>
        </div>

        <!-- Main Content -->
        <div class="max-w-4xl mx-auto">
            <!-- Controls Panel -->
            <div class="joke-card rounded-2xl p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
                    üéõÔ∏è Joke Settings
                </h2>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <!-- Category Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üìÇ Category
                        </label>
                        <select id="category" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-dad-blue focus:border-transparent">
                            <option value="general">General</option>
                            <option value="puns">Puns</option>
                            <option value="knock-knock">Knock-Knock</option>
                            <option value="wordplay">Wordplay</option>
                            <option value="dad-classics">Dad Classics</option>
                            <option value="food">Food</option>
                            <option value="animals">Animals</option>
                            <option value="technology">Technology</option>
                        </select>
                    </div>

                    <!-- Humor Level -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üòÑ Humor Level
                        </label>
                        <select id="humorLevel" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-dad-blue focus:border-transparent">
                            <option value="mild">Mild (Family-friendly)</option>
                            <option value="medium" selected>Medium (Moderately cringy)</option>
                            <option value="extra">Extra (Maximum cringe!)</option>
                        </select>
                    </div>
                </div>

                <!-- Voice Settings -->
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üéôÔ∏è Voice Type
                        </label>
                        <select id="voiceType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-dad-blue focus:border-transparent">
                            <option value="dad">Dad Voice</option>
                            <option value="robot">Robot Voice</option>
                            <option value="dramatic">Dramatic Voice</option>
                            <option value="cheerful">Cheerful Voice</option>
                        </select>
                    </div>

                    <div class="flex items-center">
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="enableVoice" class="w-5 h-5 text-dad-blue bg-gray-100 border-gray-300 rounded focus:ring-dad-blue">
                            <span class="text-sm font-medium text-gray-700">üîä Enable Voice</span>
                        </label>
                    </div>
                </div>

                <!-- Custom Prompt -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ‚úçÔ∏è Custom Prompt (Optional)
                    </label>
                    <input 
                        type="text" 
                        id="customPrompt" 
                        placeholder="Enter a custom prompt for joke generation..."
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-dad-blue focus:border-transparent"
                    >
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button 
                        id="generateJoke" 
                        class="bg-dad-blue hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg transition duration-300 transform hover:scale-105 shadow-lg"
                    >
                        üé≠ Generate Joke
                    </button>
                    <button 
                        id="generateWithVoice" 
                        class="bg-dad-orange hover:bg-orange-600 text-white font-bold py-4 px-8 rounded-lg transition duration-300 transform hover:scale-105 shadow-lg"
                    >
                        üîä Joke + Voice
                    </button>
                </div>
            </div>

            <!-- Joke Display -->
            <div id="jokeContainer" class="joke-card rounded-2xl p-8 mb-8 hidden">
                <div class="text-center">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">
                        üé≠ Your Dad Joke
                    </h3>
                    <div id="jokeText" class="text-2xl font-medium text-gray-800 mb-4 leading-relaxed">
                        <!-- Joke will appear here -->
                    </div>
                    <div id="jokeMeta" class="text-sm text-gray-600 mb-4">
                        <!-- Metadata will appear here -->
                    </div>
                    <div id="audioPlayer" class="hidden">
                        <audio controls class="w-full max-w-md mx-auto">
                            <source id="audioSource" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingContainer" class="joke-card rounded-2xl p-8 mb-8 hidden">
                <div class="text-center">
                    <div class="pulse-animation text-4xl mb-4">ü§î</div>
                    <p class="text-xl text-gray-700">Generating the perfect dad joke...</p>
                    <p class="text-sm text-gray-500 mt-2">This might take a moment</p>
                </div>
            </div>

            <!-- Error State -->
            <div id="errorContainer" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-8 hidden">
                <div class="flex">
                    <div class="py-1">
                        <svg class="fill-current h-6 w-6 text-red-500 mr-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                            <path d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z"/>
                        </svg>
                    </div>
                    <div>
                        <p class="font-bold">Error!</p>
                        <p id="errorMessage" class="text-sm">Something went wrong.</p>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="joke-card rounded-2xl p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">
                    üìä Joke Statistics
                </h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold text-dad-blue" id="totalJokes">0</div>
                        <div class="text-sm text-gray-600">Total Jokes</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-dad-orange" id="aiJokes">0</div>
                        <div class="text-sm text-gray-600">AI Generated</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-green-600" id="voiceJokes">0</div>
                        <div class="text-sm text-gray-600">With Voice</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-purple-600" id="categoriesUsed">0</div>
                        <div class="text-sm text-gray-600">Categories</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-12 text-white/80">
            <p>Made with ‚ù§Ô∏è and lots of dad jokes</p>
            <p class="text-sm mt-2">
                <a href="/dashboard" class="underline hover:text-white">Advanced Dashboard</a> |
                <a href="/api/health" class="underline hover:text-white">API Health</a> |
                <a href="https://github.com/yourusername/pundora" class="underline hover:text-white">GitHub</a>
            </p>
        </div>
    </div>

    <script>
        // Global state
        let stats = {
            totalJokes: 0,
            aiJokes: 0,
            voiceJokes: 0,
            categoriesUsed: new Set()
        };

        // DOM elements
        const generateJokeBtn = document.getElementById('generateJoke');
        const generateWithVoiceBtn = document.getElementById('generateWithVoice');
        const jokeContainer = document.getElementById('jokeContainer');
        const loadingContainer = document.getElementById('loadingContainer');
        const errorContainer = document.getElementById('errorContainer');
        const jokeText = document.getElementById('jokeText');
        const jokeMeta = document.getElementById('jokeMeta');
        const audioPlayer = document.getElementById('audioPlayer');
        const audioSource = document.getElementById('audioSource');

        // Event listeners
        generateJokeBtn.addEventListener('click', () => generateJoke(false));
        generateWithVoiceBtn.addEventListener('click', () => generateJoke(true));

        // Generate joke function
        async function generateJoke(withVoice = false) {
            // Show loading state
            showLoading();
            hideError();
            hideJoke();

            try {
                const category = document.getElementById('category').value;
                const humorLevel = document.getElementById('humorLevel').value;
                const voiceType = document.getElementById('voiceType').value;
                const customPrompt = document.getElementById('customPrompt').value;

                let url = `/api/joke?category=${category}&humor_level=${humorLevel}`;
                if (customPrompt) {
                    url += `&custom_prompt=${encodeURIComponent(customPrompt)}`;
                }

                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Update stats
                updateStats(data, withVoice);

                // Display joke
                displayJoke(data);

                // Generate voice if requested
                if (withVoice) {
                    await generateVoice(data.joke, voiceType);
                }

            } catch (error) {
                console.error('Error generating joke:', error);
                showError('Failed to generate joke. Please try again.');
            } finally {
                hideLoading();
            }
        }

        // Generate voice function
        async function generateVoice(text, voiceType) {
            try {
                const response = await fetch(`/api/voice?text=${encodeURIComponent(text)}&voice=${voiceType}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                
                audioSource.src = audioUrl;
                audioPlayer.classList.remove('hidden');
                
                // Auto-play the audio
                const audio = audioPlayer.querySelector('audio');
                audio.load();
                audio.play().catch(e => console.log('Auto-play prevented:', e));

            } catch (error) {
                console.error('Error generating voice:', error);
                showError('Failed to generate voice. Joke text is still available.');
            }
        }

        // Display joke
        function displayJoke(data) {
            jokeText.textContent = data.joke;
            jokeMeta.innerHTML = `
                <span class="inline-block bg-dad-blue text-white px-3 py-1 rounded-full text-xs mr-2">${data.category}</span>
                <span class="inline-block bg-dad-orange text-white px-3 py-1 rounded-full text-xs mr-2">${data.humor_level}</span>
                <span class="inline-block bg-gray-500 text-white px-3 py-1 rounded-full text-xs">${data.source}</span>
            `;
            jokeContainer.classList.remove('hidden');
        }

        // Update statistics
        function updateStats(data, withVoice) {
            stats.totalJokes++;
            if (data.source === 'ai') stats.aiJokes++;
            if (withVoice) stats.voiceJokes++;
            stats.categoriesUsed.add(data.category);

            document.getElementById('totalJokes').textContent = stats.totalJokes;
            document.getElementById('aiJokes').textContent = stats.aiJokes;
            document.getElementById('voiceJokes').textContent = stats.voiceJokes;
            document.getElementById('categoriesUsed').textContent = stats.categoriesUsed.size;
        }

        // UI state functions
        function showLoading() {
            loadingContainer.classList.remove('hidden');
        }

        function hideLoading() {
            loadingContainer.classList.add('hidden');
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            errorContainer.classList.remove('hidden');
        }

        function hideError() {
            errorContainer.classList.add('hidden');
        }

        function hideJoke() {
            jokeContainer.classList.add('hidden');
            audioPlayer.classList.add('hidden');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé≠ Pundora loaded successfully!');
        });
    </script>
</body>
</html>